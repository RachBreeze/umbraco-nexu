# Umbraco Magical Build Pipeline
# Worry less about build stuff and code more...
#
# 1. Ensure Secret Store has 'UMB_API_KEY' for pushing the ZIP package to our.umbraco.com
name: Magical Build
on:
  push:
    branches:
      - develop                          # Push events on master branch.
jobs:
  unicorn-dust:                         # Name of Job
    runs-on: windows-latest             # Make sure we run this on a Windows VM/image
    env:
      PKG_VERSION: '2.0.0'              # UPDATE ME
    steps:
      - uses: actions/checkout@master   # Go & fetch the REPO & do a git checkout
      - uses: actions/setup-dotnet@v1   # Downloads & adds dotnet to PATH
        with:
          dotnet-version: '2.2.103'     # SDK Version to use
      - name: Dump GitHub context
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}
        run: echo "$GITHUB_CONTEXT.sha"
      - name: Setup Nuget.exe in PATH
        uses: warrenbuckley/Setup-Nuget@v1
      - name : Nuget restore
        working-directory: './src'    
        run : nuget restore
      - name: dotnet msbuild               # Build the project
        working-directory: './src'
        run: dotnet msbuild  /p:Configuration=Release /restore
      - name: dotnet vstests               # Runs tests
        working-directory: './src'
        run: dotnet vstest Our.Umbraco.Nexu.Web.Tests\bin\Release\Our.Umbraco.Nexu.Web.Tests.dll Our.Umbraco.Nexu.Core.Tests\bin\Release\Our.Umbraco.Nexu.Core.Tests.dll
      
